!function(){var n=tinymce.DOM,t=tinymce.dom.DomQuery,e=tinymce.dom.Event,i=tinymce.dom.EventUtils,o=tinymce.is;tinymce.create("tinymce.plugins.EditorWindow",{getInfo:function(){return{longname:"EditorWindow",author:"Schuyler Duveen",authorurl:"http://ctl.columbia.edu/",infourl:"http://mediathread.info/",version:"0.9"}},init:function(t,e){var i=this;n.loadCSS(e+"/css/editorwindow.css"),t.onNodeChange.add(this._nodeChanged,this),t.onKeyDown.add(function(n,t){i._closeOnEscape(t)}),t.addCursorWindow=function(n){if(!n||"function"!=typeof n.test)throw"addCursorWindow object must have a .test function!";"function"==typeof n.content&&i._listeners.push(n)}},_closeOnEscape:function(n){27===n.keyCode&&this.opened&&(this._closeWindow(),e.clean(n))},_listeners:[{name:"link",test:function(t){var e=n.getParent(t,"A");return e&&!e.name?e:void 0},content:function(t){return n.create("a",{href:t.href,target:"_blank"},"open link")}}],_nodeChanged:function(n,t,e,i,o){if("object"==typeof o&&o.initial===!0)return!1;for(var s=this,d=s._listeners.length;--d>=0;){var r=s._listeners[d].test(e);if(r){this.opened&&(r===this.tag_for_window?this._positionWindow(n,e,r):this._closeWindow()),this.opened||r===this.tag_for_window||(this.opened=s._listeners[d],this.tag_for_window=r,this._openWindow(n,e,r));break}}0>d&&(this._closeWindow(),this.tag_for_window=!1)},getAbsoluteCursorPos:function(t,e,i){var o={container:t.getContentAreaContainer()},s=n.getPos(e),d=i?n.getPos(i):s,r=n.getPos(o.container);return o.x=d.x+r.x,o.y=s.y+r.y,o},_positionWindow:function(t,e,i){var o=this.getAbsoluteCursorPos(t,e,i),s=n.getRect(this.win),d=n.getViewPort(window),r=o.y-jQuery(document).scrollTop()+20;n.setStyles(this.win,{top:r+"px",left:Math.min(o.x+10,Math.max(0,d.w-s.w-20))+"px"})},_newWindow:function(t){var e=n.create("div",{"class":"mce_editorwindow",id:t});return this._addAll(e,["div",{id:t+"_top"},["a",{id:t+"_close","class":"mce_editorwindow_closebtn",tabindex:"-1",href:"#"},"x"],["div",{id:t+"_content"}]]),i.bind(window,"keydown",this._closeOnEscape,this),e},_openWindow:function(e,i,o){var s=this,d=n.uniqueId();this.win=this._newWindow(d),document.body.appendChild(this.win),n.get(d+"_content").appendChild(this.opened.content(o)),this._positionWindow(e,i,o),t("#"+d+"_close").on("click",function(n){n.preventDefault(),s._closeWindow(e,i)})},_closeWindow:function(t,i){this.opened&&"function"==typeof this.opened.onUnload&&this.opened.onUnload(this.win),this.opened=!1,this.win&&(e.unbind(window,"keydown",this._closeOnEscape,this),n.remove(this.win),delete this.win)},_addAll:function(t,e){var i,s=this;if(o(e,"string"))t.appendChild(n.doc.createTextNode(e));else if(e.length)for(t=t.appendChild(n.create(e[0],e[1])),i=2;i<e.length;i++)s._addAll(t,e[i])}}),tinymce.PluginManager.add("editorwindow",tinymce.plugins.EditorWindow)}();
