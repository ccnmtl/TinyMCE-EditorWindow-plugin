!function(){var n=tinymce.DOM,t=tinymce.dom.DomQuery,e=tinymce.dom.Event,i=tinymce.dom.EventUtils,o=tinymce.is;tinymce.create("tinymce.plugins.EditorWindow",{getInfo:function(){return{longname:"EditorWindow",author:"Schuyler Duveen at Columbia Center for New Media Teaching and Learning",authorurl:"http://ctl.columbia.edu/",infourl:"http://mediathread.info/",version:"0.9"}},init:function(t,e){var i=this;n.loadCSS(e+"/css/editorwindow.css"),t.onNodeChange.add(this._nodeChanged,this),t.onKeyDown.add(function(n,t){i._closeOnEscape(t)}),t.addCursorWindow=function(n){if(!n||"function"!=typeof n.test)throw"addCursorWindow object must have a .test function!";"function"==typeof n.content&&i._listeners.push(n)}},_closeOnEscape:function(n){27===n.keyCode&&this.opened&&(this._closeWindow(),e.clean(n))},_listeners:[{name:"link",test:function(t){var e=n.getParent(t,"A");return e&&!e.name?e:void 0},content:function(t){return n.create("a",{href:t.href,target:"_blank"},"open link")}}],_nodeChanged:function(n,t,e,i,o){if("object"==typeof o&&o.initial===!0)return!1;for(var d=this,s=d._listeners.length;--s>=0;){var r=d._listeners[s].test(e);if(r){this.opened&&(r===this.tag_for_window?this._positionWindow(n,e,r):this._closeWindow()),this.opened||r===this.tag_for_window||(this.opened=d._listeners[s],this.tag_for_window=r,this._openWindow(n,e,r));break}}0>s&&(this._closeWindow(),this.tag_for_window=!1)},getAbsoluteCursorPos:function(t,e,i){var o={container:t.getContentAreaContainer()},d=n.getPos(e),s=i?n.getPos(i):d,r=n.getPos(o.container);return o.x=s.x+r.x,o.y=d.y+r.y,o},_positionWindow:function(t,e,i){var o=this.getAbsoluteCursorPos(t,e,i),d=n.getRect(this.win),s=n.getViewPort(window),r=o.y-jQuery(document).scrollTop()+20;n.setStyles(this.win,{top:r+"px",left:Math.min(o.x+10,Math.max(0,s.w-d.w-20))+"px"})},_newWindow:function(t){var e=n.create("div",{"class":"mce_editorwindow",id:t});return this._addAll(e,["div",{id:t+"_top"},["a",{id:t+"_close","class":"mce_editorwindow_closebtn",tabindex:"-1",href:"#"},"x"],["div",{id:t+"_content"}]]),i.bind(window,"keydown",this._closeOnEscape,this),e},_openWindow:function(e,i,o){var d=this,s=n.uniqueId();this.win=this._newWindow(s),document.body.appendChild(this.win),n.get(s+"_content").appendChild(this.opened.content(o)),this._positionWindow(e,i,o),t("#"+s+"_close").on("click",function(n){n.preventDefault(),d._closeWindow(e,i)})},_closeWindow:function(t,i){this.opened&&"function"==typeof this.opened.onUnload&&this.opened.onUnload(this.win),this.opened=!1,this.win&&(e.unbind(window,"keydown",this._closeOnEscape,this),n.remove(this.win),delete this.win)},_addAll:function(t,e){var i,d=this;if(o(e,"string"))t.appendChild(n.doc.createTextNode(e));else if(e.length)for(t=t.appendChild(n.create(e[0],e[1])),i=2;i<e.length;i++)d._addAll(t,e[i])}}),tinymce.PluginManager.add("editorwindow",tinymce.plugins.EditorWindow)}();
